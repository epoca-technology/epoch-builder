from typing import TypedDict, List, Union
from modules.types.backtest_types import IBacktestPosition




# Model Evaluation
# Evaluation performed right after the model is trained in order to get an overview of the
# potential accuracy, as well as the prediction type distribution.
# The evaluation works similarly to the backtests and it is only performed on the test
# dataset to ensure the model has not yet seen it.
#
# Early Stopping
# The process of training and evaluating models creates a massive bottleneck as computing
# resources are limited. In order to speed up the process, a Model Evaluation will stop early
# if any of the following is met:
# 1) The model reaches -20 points
# 2) The model has less than 1 long or 1 short at the first early stopping checkpoint (15% of the dataset)
# 3) The model has less than 3 longs or 3 shorts at the first early stopping checkpoint (30% of the dataset)
# 4) The model has less than 10 longs or 10 shorts at the second early stopping checkpoint (50% of the dataset)
# 5) The model has less than 15 longs or 15 shorts at the third early stopping checkpoint (70% of the dataset)
class IModelEvaluation(TypedDict):
    # Early stopping description. Will only be present is the evaluation was stopped early.
    early_stopping: Union[str, None]

    # The number of neutral predictions generated by the Model
    neutral_predictions: int

    # Positions
    positions: List[IBacktestPosition]

    # The median of the points collected during the evaluation
    points_median: float

    # The number of times the Model predicted a price increase
    increase_num: int
    increase_successful_num: int

    # The number of times the Model predicted a price decrease
    decrease_num: int
    decrease_successful_num: int

    # Accuracy
    increase_acc: int
    decrease_acc: int
    acc: int

    # Increase Predictions Overview
    increase_list: List[float]
    increase_max: float
    increase_min: float
    increase_mean: float
    increase_successful_list: List[float]
    increase_successful_max: float
    increase_successful_min: float
    increase_successful_mean: float

    # Decrease Predictions Overview
    decrease_list: List[float]
    decrease_max: float
    decrease_min: float
    decrease_mean: float
    decrease_successful_list: List[float]
    decrease_successful_max: float
    decrease_successful_min: float
    decrease_successful_mean: float

    # Outcomes
    increase_outcomes: int
    decrease_outcomes: int