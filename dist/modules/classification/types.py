from typing import TypedDict, List, Union, Dict, Any
from modules.model import IModel






# Active Training Data Position
# When a position is opened, the active position dict is populated with the up and down price values
# as well as the predictions generated by the Single Models. Once the position closes, the row dict
# is completed with the up and down values
class ITrainingDataActivePosition(TypedDict):
    up_price: float         # The price in which the position will be closed as up
    down_price: float       # The price in which the position will be closed as down
    row: Dict[str, int]     # Model's features which will be completed with labels once the position closes









# Training Data Insights
# Data used to represent the proportions for the price changes and the position types generated by the 
# single models.
class ITrainingDataPriceActionsInsight(TypedDict):
    up: float
    down: float
class ITrainingDataPredictionInsight(TypedDict):
    long: float
    short: float
    neutral: float







# Training Data Config
# The Training configuration that resides in the configuration file and it is used to initialize
# the training data generator.
class ITrainingDataConfig(TypedDict):
    # The description of the Training Data that will be generated.
    description: str

    # Start and end time - If none provided, will use all the available data
    start: Union[str, int, None]
    end: Union[str, int, None]

    # Percentages that will determine if the price moved up or down after a position is opened
    up_percent_change: float
    down_percent_change: float

    # The list of Model configs that will be used
    arima_models: List[IModel]





# Training Data File
# The dict that contains all the information needed to train DecisionModels.
class ITrainingDataFile(ITrainingDataConfig):
    # Universally Unique Identifier (uuid4)
    id: str

    # Secondary Identifier generated based on the arima_models
    arima_id: str

    # The timestamp in which the Training Data was generated
    creation: int

    # Start and end time
    start: int  # First candlestick's ot
    end: int    # Last candlestick's ct

    # The number of minutes that took to generate the training data
    duration_minutes: int

    # Shape of the data
    rows: int
    columns: int

    # Price Actions Insight - The up and down percentage proportions
    price_actions_insight: ITrainingDataPriceActionsInsight

    # Prediction Insight 
    # Position type percentage proportions for each single model in this format:
    # {[modelID: str]: ITrainingDataPredictionInsight}
    predictions_insight: Dict[str, Dict[str, float]]

    # Training Data
    # The list of rows that are appended on position close. This is the data that
    # will be used to train models.
    training_data: List[Dict[str, int]]



